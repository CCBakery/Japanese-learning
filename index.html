<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Again（OP）听歌学日语 · Romaji + 中文</title>
<style>
  :root { --bg:#0f1115; --card:#171a21; --muted:#9aa3af; --text:#e5e7eb; --brand:#60a5fa; }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
  header{padding:12px 16px;border-bottom:1px solid #222;display:flex;gap:12px;align-items:center}
  header h1{font-size:16px;margin:0;font-weight:600}
  .wrap{display:grid;grid-template-columns:1.3fr 1fr;gap:12px;padding:12px;min-height:calc(100vh - 54px)}
  .panel{background:var(--card);border:1px solid #222;border-radius:14px;padding:12px;overflow:auto}
  .row{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  button,.chip{background:#1f2430;border:1px solid #2a2f3a;color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer}
  button:hover,.chip:hover{border-color:#3a4252}
  .chip{font-size:12px}
  #current{font-size:20px;font-weight:700;margin:6px 0}
  #romaji{font-size:18px}
  #cn{color:var(--muted)}
  .seg{padding:8px;border-radius:10px;margin:6px 0;border:1px solid #232833;cursor:pointer}
  .seg:hover{border-color:#374151}
  .active{border-color:var(--brand);box-shadow:0 0 0 1px color-mix(in srgb, var(--brand) 50%, transparent)}
  .small{font-size:12px;color:var(--muted)}
  input[type="text"]{background:#0e1218;border:1px solid #263042;color:var(--text);padding:8px;border-radius:10px;width:180px}
  @media (max-width:900px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <h1>Again（OP）听歌学日语 · Romaji + 中文</h1>
    <span class="small">空格：播放/暂停 · ↑/↓：上一句/下一句 · T：切换翻译 · +/-：校准偏移</span>
  </header>

  <div class="wrap">
    <!-- 左：本地视频（与 index.html 同目录） -->
    <section class="panel">
      <video id="player" controls style="aspect-ratio:16/9;width:100%;border-radius:8px;display:block">
        <source src="videoplayback.mp4" type="video/mp4">
        Your browser does not support HTML5 video.
      </video>

      <div class="row" style="margin-top:8px">
        <button id="play">▶︎/⏸</button>
        <button id="prev">↑ 上一句</button>
        <button id="next">↓ 下一句</button>
        <span class="chip">偏移 <span id="offsetLabel">0.00s</span></span>
        <button id="minus">-0.10s</button>
        <button id="plus">+0.10s</button>
        <span class="chip" id="toggleCn">显示/隐藏中文</span>
        <input id="jump" type="text" placeholder="跳到 00:45 或 45.0s"/>
        <button id="go">Go</button>
      </div>
      <div class="small" style="margin-top:6px">
        右侧列表可点击跳转；若不同步，用 +/- 微调偏移。
      </div>
    </section>

    <!-- 右：当前句 + 列表 -->
    <section class="panel">
      <div class="small">当前句</div>
      <div id="current"></div>
      <div id="romaji"></div>
      <div id="cn"></div>
      <hr style="border:0;border-top:1px solid #232833;margin:10px 0">
      <div class="small">句子列表（可点击跳转）</div>
      <div id="list"></div>
    </section>
  </div>

  <!-- 数据：按你的视频版本微调 start/end（秒） -->
  <script>
  const SEGMENTS = [
  { id:"L1", start: 0.00, end: 3.00,
    jp:"この想いを｜消してしまうには",
    romaji:"kono omoi wo keshite shimau niwa",
    zh:"要是想把这份思念抹去的话"
  },
  { id:"L2", start: 3.00, end: 6.00,
    jp:"まだ人生｜長いでしょ",
    romaji:"mada jinsei nagai desho",
    zh:"人生还很长吧"
  },
  { id:"L3", start: 7.00, end: 9.00,
    jp:"やり残してること｜やり直してみたいから",
    romaji:"yarinokoshite'ru koto yarinaoshite mitai kara",
    zh:"因为我想把那些没做完的事情重新再来一次"
  },

  { id:"L4", start: 9.00, end: 12.00,
    jp:"夢の続き｜追いかけていたはずなのに",
    romaji:"yume no tsuzuki oikakete ita hazu nano ni",
    zh:"明明本该是在追逐梦想的续篇"
  },
  { id:"L5", start: 12.00, end: 15.00,
    jp:"曲がりくねった｜細い道 人に躓く",
    romaji:"magarikunetta hosoi michi hito ni tsumazuku",
    zh:"却在曲折狭窄的小路上被别人绊倒"
  },
  { id:"L6", start: 15.00, end: 18.00,
    jp:"あの頃みたいにって｜戻りたいわけじゃないの なくしてきた空を 探してる",
    romaji:"ano koro mitai ni tte modoritai wakejanai no nakushite kita sora wo sagashite'ru",
    zh:"说“像那时候一样”并不是想回到过去 只是在找回那片失去的天空"
  },
  { id:"L7", start: 18.00, end: 21.00,
    jp:"分かってくれますように｜犠牲になったような 悲しい顔は やめてよ",
    romaji:"wakatte kuremasu you ni gisei ni natta you na kanashii kao wa yamete yo",
    zh:"希望你能明白 不要再露出那种好像自己成了牺牲品的表情"
  },

  { id:"L8", start: 21.00, end: 24.00,
    jp:"罪の最後は涙じゃないよ",
    romaji:"tsumi no saigo wa namida ja nai yo",
    zh:"罪的结局并不只是用眼泪收场"
  },
  { id:"L9", start: 24.00, end: 27.00,
    jp:"ずっと苦しく背負ってくんだ",
    romaji:"zutto kurushiku seotte'ku n da",
    zh:"而是要一直痛苦地背负下去"
  },
  { id:"L10", start: 27.00, end: 30.00,
    jp:"出口見えない感情迷路に 誰を待ってるの",
    romaji:"deguchi mienai kanjou meiro ni dare wo matte'ru no",
    zh:"在看不到出口的感情迷宫里 我到底在等谁"
  },
  { id:"L11", start: 30.00, end: 33.00,
    jp:"白いノートに綴ったように",
    romaji:"shiroi nooto ni tsuzutta you ni",
    zh:"多想像写在白色笔记本上一样"
  },
  { id:"L12", start: 33.00, end: 36.00,
    jp:"もっと素直に吐き出したいよ",
    romaji:"motto sunao ni hakidashitai yo",
    zh:"把真正的心情坦率地全部吐露出来"
  },
  { id:"L13", start: 36.00, end: 39.00,
    jp:"何から 逃れたいんだ",
    romaji:"nani kara nogaretai n da",
    zh:"我到底是想逃离什么呢"
  },
  { id:"L14", start: 39.00, end: 42.00,
    jp:"現実ってやつか",
    romaji:"genjitsu tte yatsu ka",
    zh:"是那个所谓的“现实”吗"
  },

  { id:"L15", start: 42.00, end: 45.00,
    jp:"叶える為に生きてるんだって 叫びたくなるよ 聞こえていますか",
    romaji:"kanaeru tame ni ikite'ru n datte sakebitaku naru yo kikoete imasu ka",
    zh:"想大声喊出“我就是为了实现愿望而活着的” 你听得见吗"
  },
  { id:"L16", start: 45.00, end: 48.00,
    jp:"無難になんてやってられないから",
    romaji:"bunan ni nante yatte'rarenai kara",
    zh:"因为已经没法再走那种安全保守的路了"
  },
  { id:"L17", start: 48.00, end: 51.00,
    jp:"帰る場所もないの",
    romaji:"kaeru basho mo nai no",
    zh:"也已经没有可以回去的地方"
  },
  { id:"L18", start: 51.00, end: 54.00,
    jp:"優しさにはいつも感謝してる だから強くなりたい",
    romaji:"yasashisa niwa itsumo kansha shite'ru dakara tsuyoku naritai",
    zh:"一直对周围的温柔心存感激 正因为这样才想变得更坚强"
  },
  { id:"L19", start: 54.00, end: 57.00,
    jp:"懐かしくなる こんな痛みも歓迎じゃん",
    romaji:"natsukashiku naru konna itami mo kangei jan",
    zh:"连这种会让人怀念的痛苦 也当成值得欢迎的东西"
  }
];

  </script>

  <!-- 逻辑（HTML5 video 版本） -->
  <script>
  const video = document.getElementById('player');
  let curIndex = -1, showCn = true, offset = 0;

  // UI
  const $ = id => document.getElementById(id);
  function syncOffset(){ $('offsetLabel').textContent = offset.toFixed(2)+'s'; }
  function fmtTime(s){ const m=Math.floor(s/60), sec=(s%60).toFixed(2).padStart(5,'0'); return `${m}:${sec}`; }

  function renderCurrent(){
    const cur = SEGMENTS[curIndex];
    $('current').textContent = cur ? cur.jp : '--';
    $('romaji').textContent = '';
    $('cn').textContent = '';
  }
  function highlight(i){
    document.querySelectorAll('.seg').forEach(el=>el.classList.remove('active'));
    if(i>=0){ const el = document.querySelector(`.seg[data-index="${i}"]`); if(el){ el.classList.add('active'); el.scrollIntoView({block:'nearest'}); } }
  }
  function buildList(){
    const wrap = $('list'); wrap.innerHTML='';
    SEGMENTS.forEach((s,i)=>{
      const d = document.createElement('div');
      d.className='seg'; d.dataset.index=i;
      d.innerHTML = `<div><strong>${s.jp}</strong></div>
                     <div>${s.romaji}</div>
                     <div class="small">${s.zh} · ${fmtTime(s.start)} – ${fmtTime(s.end)}</div>`;
      d.onclick = ()=> jumpTo(i);
      wrap.appendChild(d);
    });
  }
  function jumpTo(i){
    const s = SEGMENTS[i]; if(!s) return;
    video.currentTime = Math.max(0, s.start - offset);
    video.play();
  }

  // 时间驱动：HTML5 video 的 timeupdate 事件
  video.addEventListener('timeupdate', ()=>{
    const t = video.currentTime + offset;
    const i = SEGMENTS.findIndex(s => t>=s.start && t<s.end);
    if(i !== curIndex){ curIndex = i; renderCurrent(); highlight(i); }
  });

  // 按钮与快捷键
  $('play').onclick = ()=> video.paused ? video.play() : video.pause();
  $('prev').onclick = ()=> jumpTo(Math.max(0, (curIndex>0 ? curIndex-1 : 0)));
  $('next').onclick = ()=> jumpTo(Math.min(SEGMENTS.length-1, (curIndex>=0 ? curIndex+1 : 0)));
  $('toggleCn').onclick = ()=> { showCn=!showCn; renderCurrent(); };
  $('minus').onclick = ()=> { offset -= 0.10; syncOffset(); };
  $('plus').onclick = ()=> { offset += 0.10; syncOffset(); };
  $('go').onclick = ()=> {
    const v = $('jump').value.trim(); if(!v) return;
    let sec = 0;
    if(/^\d+:\d+(\.\d+)?$/.test(v)){ const [m,s]=v.split(':'); sec = (+m)*60 + (+s); }
    else sec = parseFloat(v);
    if(!isNaN(sec)){ video.currentTime = Math.max(0, sec - offset); video.play(); }
  };
  document.addEventListener('keydown', e=>{
    if(e.target.tagName==='INPUT') return;
    if(e.code==='Space'){ e.preventDefault(); $('play').click(); }
    if(e.key==='+'){ $('plus').click(); }
    if(e.key==='-'){ $('minus').click(); }
    if(e.key==='ArrowUp'){ $('prev').click(); }
    if(e.key==='ArrowDown'){ $('next').click(); }
    if(e.key.toLowerCase()==='t'){ $('toggleCn').click(); }
  });

  // 初始化
  buildList(); syncOffset(); renderCurrent();
  </script>
</body>
</html>
